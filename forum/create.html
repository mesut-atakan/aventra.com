<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Aventra Forum | Yeni Konu Oluştur</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Editor.js ve tool'lar -->
  <script src="https://cdn.jsdelivr.net/npm/@editorjs/editorjs@2.29.1"></script>
  <script src="https://cdn.jsdelivr.net/npm/@editorjs/header@2.7.0"></script>
  <script src="https://cdn.jsdelivr.net/npm/@editorjs/list@1.8.0"></script>
  <script src="https://cdn.jsdelivr.net/npm/@editorjs/image@2.8.1"></script>
  <script src="https://cdn.jsdelivr.net/npm/@editorjs/quote@2.5.0"></script>
  <script src="https://cdn.jsdelivr.net/npm/@editorjs/code@2.8.0"></script>
  <script src="https://cdn.jsdelivr.net/npm/@editorjs/table@1.2.2"></script>
  <script src="https://cdn.jsdelivr.net/npm/@editorjs/checklist@1.3.0"></script>
  <script src="https://cdn.jsdelivr.net/npm/@editorjs/delimiter@1.3.0"></script>
  <script src="https://cdn.jsdelivr.net/npm/@editorjs/warning@1.2.0"></script>
  <script src="https://cdn.jsdelivr.net/npm/@editorjs/marker@1.2.2"></script>
  <script src="https://cdn.jsdelivr.net/npm/@editorjs/link@2.4.0"></script>
  <style>
    :root {
      --orange: #FF6600;
      --dark: #2B0B3F;
      --dark-accent: #6E2B6D;
      --light: #F4F4F4;
      --text: #F9F9F9;
    }
    body {
      background: #1a1a22;
      color: #f3f3fa;
      font-family: 'Segoe UI',sans-serif;
      margin: 0;
      min-height: 100vh;
    }
    header {
      background-color: var(--orange);
      color: white;
      padding: 1.1rem 1.7rem 1rem 1.3rem;
      display: flex;
      align-items: center;
      box-shadow: 0 4px 8px rgba(0,0,0,0.36);
    }
    .aventra-logo-link {
      text-decoration:none;
      display:flex;
      align-items:center;
      gap:.6rem;
    }
    .aventra-logo-img {
      height:38px;
      width:auto;
      display:block;
    }
    .aventra-logo-text {
      font-weight:900;
      letter-spacing:.0px;
      color:#fff;
      font-size:1.28rem;
    }
    .forum-container {
      max-width: 800px;
      margin: 36px auto;
      background: #242438;
      border-radius: 16px;
      box-shadow: 0 8px 32px #0007;
      padding: 32px 24px;
    }
    .forum-title {
      text-align: center;
      font-size: 2rem;
      margin-bottom: 28px;
      color: #ff6600;
      font-weight: bold;
    }
    .input-label {
      font-weight: 500;
      color: #ff9900;
      font-size: 1.1rem;
      margin-bottom: 6px;
      display: block;
    }
    #forumSubject {
      width: 100%;
      padding: 12px 16px;
      border: 1.5px solid #444456;
      border-radius: 10px;
      background: #222234;
      color: #fff;
      font-size: 1.1rem;
      margin-bottom: 26px;
      outline: none;
      transition: border .2s;
    }
    #forumSubject:focus { border-color: #ff6600; }
    #editorjs {
      background: #222234;
      border-radius: 10px;
      padding: 18px;
      min-height: 220px;
      margin-bottom: 26px;
    }
    #saveBtn {
      display: block;
      margin: 0 auto;
      background: #ff6600;
      color: #fff;
      border: none;
      padding: 14px 50px;
      border-radius: 24px;
      font-size: 18px;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 4px 18px #ff660050;
      transition: background .2s;
    }
    #saveBtn:hover { background: #ff9900; }
    /* INLINE TOOLBAR -- B/I/Link/Marker ikonları */
    .ce-inline-toolbar__buttons svg {
      fill: #c8cad8 !important;
      color: #c8cad8 !important;
      opacity: 0.78 !important;
      stroke-width: 1.2 !important;
      transition: fill .2s, color .2s, opacity .2s;
    }
    .ce-inline-toolbar__buttons button:hover svg,
    .ce-inline-toolbar__buttons .ce-inline-tool--active svg {
      fill: #ff6600 !important;
      color: #ff6600 !important;
      opacity: 1 !important;
    }
    /* CONVERT TOOLBAR (CONVERT TO PANEL) */
    .ce-conversion-toolbar,
    .ce-conversion-toolbar__tools,
    .ce-inline-toolbar,
    .ce-inline-toolbar__dropdown {
      background: #27273a !important;
      box-shadow: 0 8px 32px #0006 !important;
      border-radius: 12px !important;
      border: 1px solid #29294c !important;
    }
    .ce-conversion-toolbar__tool svg,
    .ce-conversion-toolbar__icon svg {
      fill: #6d7080 !important;   /* Koyu soft gri */
      color: #6d7080 !important;
      opacity: 0.93 !important;
      stroke-width: 1.2 !important;
      transition: fill .18s, color .18s, opacity .18s;
    }
    .ce-conversion-toolbar__tool--focused svg,
    .ce-conversion-toolbar__tool--active svg,
    .ce-conversion-toolbar__tool:hover svg {
      fill: #ff6600 !important;
      color: #ff6600 !important;
      opacity: 1 !important;
    }
    .ce-conversion-toolbar__label {
      font-size: 15px !important;
      letter-spacing: .02em !important;
      color: #ff9900 !important;
      font-weight: 600 !important;
    }
    .ce-conversion-toolbar__tool[disabled] svg,
    .ce-conversion-toolbar__tool--disabled svg {
      fill: #444658 !important;
      color: #444658 !important;
      opacity: 0.4 !important;
    }
    @media (max-width: 700px) {
      .forum-container { padding: 12px 2vw; }
      #forumSubject { font-size: 1rem; }
      #saveBtn { width: 100%; font-size: 1rem; padding: 14px 0; }
      #editorjs { padding: 8px; }
      header { padding: 1rem 1vw 1rem 2vw;}
    }
  </style>
</head>
<body>
    <header>
        <a class="aventra-logo-link" href="/index.html">
            <img class="aventra-logo-img" src="../assets/images/aventra_woutbg.png" alt="Ventra Logo" />
            <span class="aventra-logo-text">VENTRA</span>
        </a>
    </header>
    <div class="forum-container">
        <div class="forum-title">Yeni Konu Oluştur</div>
        <label class="input-label" for="forumSubject">Konu Başlığı</label>
        <input id="forumSubject" placeholder="Konu başlığını yaz..." maxlength="80" autocomplete="off" />
        <div id="editorjs"></div>
        <button id="saveBtn">Formu Yayınla</button>
    </div>
    <pre id="result" style="display:none"></pre>
    <script>
        // Editor.js init
        const editor = new EditorJS({
        holder: 'editorjs',
        placeholder: "Konu detayını ve açıklamanı yaz...",
        tools: {
        header: window.Header,
        list: window.List,
        image: {
        class: window.ImageTool,
        config: {
        endpoints: {
        byFile: '/api/uploadFile',
        byUrl: '/api/fetchUrl',
        }
        }
        },
        quote: window.Quote,
        code: window.CodeTool,
        table: window.Table,
        checklist: window.Checklist,
        delimiter: window.Delimiter,
        warning: window.Warning,
        marker: window.Marker,
        linkTool: {
        class: window.LinkTool,
        config: {
        endpoint: '/api/fetchUrl'
        }
        }
        }
        });

        document.getElementById('saveBtn').addEventListener('click', function() {
        const subject = document.getElementById('forumSubject').value.trim();
        if (!subject) {
        alert("Konu başlığı boş bırakılamaz.");
        return;
        }
        editor.save().then((outputData) => {
        // Backend'e göndermek için forum verisi:
        const forumPost = {
        title: subject,
        content: outputData,
        createdAt: Date.now(),
        };
        // Burada formun yayına alınmasını sağlayan işlemleri ekle.
        // Mesela fetch ile bir backend API'ye gönder veya başka bir sayfaya yönlendir.
        console.log(forumPost);
        document.getElementById('result').textContent = JSON.stringify(forumPost, null, 2);
        }).catch((error) => {
        alert("Hata: " + error);
        });
        });
    </script>

    <script type="module">
        import { db } from './firebase-init.js';
        import { getAuth } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-auth.js";
        import { collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js";

        // EditorJS zaten yukarıda kurulu!
        document.getElementById('saveBtn').addEventListener('click', function() {
        const subject = document.getElementById('forumSubject').value.trim();
        if (!subject) return;

        editor.save().then(async (outputData) => {
        const auth = getAuth();
        const user = auth.currentUser;
        if (!user) {
        window.location.href = "login.html";
        return;
        }
        await addDoc(collection(db, "forums"), {
        title: subject,
        content: JSON.stringify(outputData),
        createdAt: serverTimestamp(),
        authorId: user.uid,
        });
        window.location.href = "forums.html";
        }).catch((error) => {
        // Hiçbir alert yok, hata olursa sessizce geçer.
        });
        });
        window.location.href = "forums.html";
    </script>
</body>
</html>
